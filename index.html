<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Just Roger">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Just Roger">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Just Roger">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> Just Roger </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Just Roger</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">a running programmer</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/27/dbscan/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="roger">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Just Roger">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Just Roger" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/27/dbscan/" itemprop="url">
                  dbscan
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Дата создания записи" itemprop="dateCreated datePublished" datetime="2016-09-27T14:28:27+08:00">
                2016-09-27
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/09/27/dbscan/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/27/dbscan/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/09/27/dbscan/" class="leancloud_visitors" data-flag-title="dbscan">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">DBSCAN(D, eps, Minpts)</span><br><span class="line"></span><br><span class="line">	C=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> each unvisited point P <span class="keyword">in</span> dataset D</span><br><span class="line"></span><br><span class="line">		mark P <span class="keyword">as</span> visited</span><br><span class="line"></span><br><span class="line">		N=getNeighbors(P, eps)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> sizeOf(N) &lt; Mints</span><br><span class="line"></span><br><span class="line">			mark P <span class="keyword">as</span> NOISE</span><br><span class="line"></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">			C=next cluster</span><br><span class="line"></span><br><span class="line">			expandCluster(P, N, C, eps, Minpts)</span><br><span class="line"></span><br><span class="line">expandCluster(P, N, C, eps, Minpts)</span><br><span class="line"></span><br><span class="line">	add P to cluster C</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> each point P’ <span class="keyword">in</span> N</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> P’ <span class="keyword">is</span> <span class="keyword">not</span> visited</span><br><span class="line"></span><br><span class="line">			mark P’ <span class="keyword">as</span> visited</span><br><span class="line"></span><br><span class="line">			N’=getNeighbors(P’, eps)</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> sizeOf(N’) &gt;= minPts</span><br><span class="line"></span><br><span class="line">				N = N joined <span class="keyword">with</span> N’</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> P’ <span class="keyword">is</span> <span class="keyword">not</span> yew cluster any cluster</span><br><span class="line"></span><br><span class="line">			add P’ to cluster C</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/21/hello-world/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="roger">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Just Roger">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Just Roger" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/21/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Дата создания записи" itemprop="dateCreated datePublished" datetime="2016-09-21T13:52:04+08:00">
                2016-09-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/09/21/hello-world/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/21/hello-world/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/09/21/hello-world/" class="leancloud_visitors" data-flag-title="Hello World">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick_Start"><a href="#Quick_Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create_a_new_post"><a href="#Create_a_new_post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>The Arithmetic mean is equal is $\frac{1}{n} \sum_{i=i}^{n} x_{i}$, or the sumation of n numbers divided by n.</p>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run_server"><a href="#Run_server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate_static_files"><a href="#Generate_static_files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy_to_remote_sites"><a href="#Deploy_to_remote_sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/14/RDD编程/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="roger">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Just Roger">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Just Roger" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/14/RDD编程/" itemprop="url">
                  RDD编程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Дата создания записи" itemprop="dateCreated datePublished" datetime="2016-04-14T10:35:42+08:00">
                2016-04-14
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/04/14/RDD编程/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/14/RDD编程/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/04/14/RDD编程/" class="leancloud_visitors" data-flag-title="RDD编程">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="RDD_u57FA_u7840"><a href="#RDD_u57FA_u7840" class="headerlink" title="RDD基础"></a>RDD基础</h1><p>弹性分布式数据集，操作方式：transform (one add to another) and action(调用add进行求值).当对rdd进行多次action操作时，使用rdd.cache()提高效率</p>
<p>两种创建rdd方式：来自外部数据集和来自对象集合</p>
<pre><code>lines=sc.textFile(&apos;README.md&apos;)
lines=sc.parallelize([&apos;good&apos;,&apos;bad&apos;])
</code></pre><h1 id="u5E38_u89C1_u8F6C_u6362_u548C_u884C_u52A8_u64CD_u4F5C"><a href="#u5E38_u89C1_u8F6C_u6362_u548C_u884C_u52A8_u64CD_u4F5C" class="headerlink" title="常见转换和行动操作"></a>常见转换和行动操作</h1><h2 id="u9488_u5BF9_u5404_u4E2A_u5143_u7D20_u7684_u8F6C_u5316_u64CD_u4F5C"><a href="#u9488_u5BF9_u5404_u4E2A_u5143_u7D20_u7684_u8F6C_u5316_u64CD_u4F5C" class="headerlink" title="针对各个元素的转化操作"></a>针对各个元素的转化操作</h2><p>map,flatMap(传入函数返回可迭代对象)，filter(返回bool类型)</p>
<h2 id="u4F2A_u96C6_u5408_u64CD_u4F5C"><a href="#u4F2A_u96C6_u5408_u64CD_u4F5C" class="headerlink" title="伪集合操作"></a>伪集合操作</h2><p>rdd.distinct():开销大，需要对所有数据通过网络进行混洗（shuffle）</p>
<p>rdd.union():会有重</p>
<p>rdd.interseciont(anoter):去重，单个rdd重复也去，也要shuffle,性能差</p>
<p>rdd.subtract(anoter):shuffle</p>
<p>rdd.sample(flalse,0,5,777): 采样，例子为50%，不放回</p>
<p>rdd.takeSample(true,100,777)</p>
<h2 id="u884C_u52A8_u64CD_u4F5C"><a href="#u884C_u52A8_u64CD_u4F5C" class="headerlink" title="行动操作"></a>行动操作</h2><p>rdd.reduce(lambda x,y :x+y):接受一个函数作为参数，这个函数要操作两个rdd的元素的数据并且返回一个同样类型的新元素，多用于计算rdd中所有元素的总和，元素的个数等。</p>
<p>rdd.collect():要求能放进一台机器的内存中，因此多用于单元测试</p>
<p>rdd.take(100): 尝试访问尽量少的分区，操作会得到一个不均衡集合，返回顺序不定</p>
<p>rdd.top(100) 返回前100，可指定排序</p>
<p>rdd.takeOrdered(100)(myordering)</p>
<p>rdd.foreach(func) 对rdd的每个元素使用func,例如 rdd.foreach(println)</p>
<h1 id="pair_rdd"><a href="#pair_rdd" class="headerlink" title="pair rdd"></a>pair rdd</h1><h2 id="for_each_pair_rdd"><a href="#for_each_pair_rdd" class="headerlink" title="for each pair rdd"></a>for each pair rdd</h2><p>rdd.reduceByKey(func): combine rdds with the same key,e.g. rdd.reduceByKey(lambda (x,y):x+y)</p>
<p>rdd.groupByKey : e.g. rdd={(1,2),(3,4),(3,6)}<br>==&gt; {(1,[2]),(3,[4,6])}</p>
<p>rdd.mapValues(func): imply func on each value with the key unchanged</p>
<p>rdd.flatMapValues(func)</p>
<p>rdd.keys(): return a new rdd consist of keys</p>
<p>rdd.values()</p>
<p>rdd.sortByKey() e.g. rdd.sortByKey(asending=true,numPartitions=None,keyFunc=labmda x:str(x))</p>
<h2 id="for_two_pair_rdd"><a href="#for_two_pair_rdd" class="headerlink" title="for two pair rdd"></a>for two pair rdd</h2><p>rdd.subtractByKey(anoter)</p>
<p>rdd.join(anoter): inner</p>
<p>rdd.leftOuterJoin(anoter)</p>
<p>rdd.rightOuterJoin(anoter)</p>
<p>rdd.cogroup(anoter): e.g. rdd={(1,2),(3,4),(3,5)} anoter={(3,6)}  ==&gt; {(1,([2],[])),(3,([4,5],[6])}</p>
<h2 id="combine_action"><a href="#combine_action" class="headerlink" title="combine action"></a>combine action</h2><p>combineByKey()?????</p>
<h2 id="pair_rdd_action"><a href="#pair_rdd_action" class="headerlink" title="pair rdd action"></a>pair rdd action</h2><p>countByKey</p>
<p>collectAsMap()</p>
<p>lookup(key)</p>
<h1 id="u7D2F_u52A0_u5668"><a href="#u7D2F_u52A0_u5668" class="headerlink" title="累加器"></a>累加器</h1><p>累加器相当于全局变量</p>
<pre><code>file=sc.textFile(&apos;input.txt&apos;)
#创建累机器并初始化为0
blankLines=sc.accumulator(0)

def extractCallSigns(line):
    global blankLines #访问全局变量
    if(lines==&quot;&quot;):
        blankLines+=1
    return line.split(&quot;\t&quot;)
callSigns=file.flatMap(extractCallSigns)
callSigns.saveAsTextFile(outputDir+&quot;/callsigns&quot;)
print &quot;blank lins: %d&quot;%blankLines.values
</code></pre><h1 id="dataframe"><a href="#dataframe" class="headerlink" title="dataframe"></a>dataframe</h1><p>generate df from sparkhive,each row is a object of ‘Row’,can convert tor rdd by ‘.rdd’ and you can get the item from the row by the index as well as the column name. e.g. x.pid ,x[0]</p>
<h1 id="u6027_u80FD_u63D0_u5347"><a href="#u6027_u80FD_u63D0_u5347" class="headerlink" title="性能提升"></a>性能提升</h1><ol>
<li>rdd.textFile(‘sss’).repartition(10000）单个机器内存不够时，重新增加分区</li>
<li>rdd.coalesce(100).saveAsTextFile</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/18/spark在hive中的应用/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="roger">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Just Roger">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Just Roger" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/18/spark在hive中的应用/" itemprop="url">
                  spark在hive中的应用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Дата создания записи" itemprop="dateCreated datePublished" datetime="2016-03-18T21:30:26+08:00">
                2016-03-18
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/03/18/spark在hive中的应用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/18/spark在hive中的应用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/03/18/spark在hive中的应用/" class="leancloud_visitors" data-flag-title="spark在hive中的应用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="u8FDE_u63A5spark_sql"><a href="#u8FDE_u63A5spark_sql" class="headerlink" title="连接spark sql"></a>连接spark sql</h1><p>sparksql提供一种特殊的rdd，叫做schemerdd,schemerdd是存放row对象的rdd，每个row对象代表一行记录。附带包含每列的类型信息。Row类型只是对基本数据类型的数组的封装。schemerdd开起来和普通的rdd很像，但是可以利用结构信息更加高效的存储数据。scheme可以从外部数据创建，也可以从查询结果或者普通rdd中创建。</p>
<p>SchemeRDD可以使用已有的rdd转化操作，比如map()和filter().furterhmore可以把任意的schemerdd注册为临时表（HiveContext.registerTempTable）</p>
<p>Row对象表示schemerdd中的记录，其本质就是一个定长的字段数组，可以使用对应的getType()方法，比如getString(0)会把字段0按照字符串返回。</p>
<pre><code>//访问toptweet这个schemerdd中的text列（第一列）
val toptweet=toptweets.map(row=&gt;row.getString(0))
</code></pre><p>若要把spark sql连接到一个部署好的hive上，必须把hive-site.xml复制到spark的配置文件目录中($spark_home/conf)。即使没有部署好hive,sparksql会在当前工作目录中创建出hive元数据库，叫作master_db。</p>
<h1 id="u5728_u5E94_u7528_u4E2D_u4F7F_u7528spark_sql"><a href="#u5728_u5E94_u7528_u4E2D_u4F7F_u7528spark_sql" class="headerlink" title="在应用中使用spark sql"></a>在应用中使用spark sql</h1><h2 id="import"><a href="#import" class="headerlink" title="import"></a>import</h2><pre><code>import org.apache.spark.sql.hive.HiveContext
import org.apache.spark.sql.SQLContext
</code></pre><h2 id="u9690_u5F0F_u8F6C_u6362_u652F_u6301"><a href="#u9690_u5F0F_u8F6C_u6362_u652F_u6301" class="headerlink" title="隐式转换支持"></a>隐式转换支持</h2><pre><code>//创建spark sql的HiveContext
val hiveCtx=...
//导入隐式转换支持
import hiveCtx._

//创建上下文环境
val sc=new SparkContext(...)
val hiveCtx=new HiveContext(sc)
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/16/spark初级/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="roger">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Just Roger">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Just Roger" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/16/spark初级/" itemprop="url">
                  spark初级
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Дата создания записи" itemprop="dateCreated datePublished" datetime="2016-03-16T15:09:56+08:00">
                2016-03-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/03/16/spark初级/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/16/spark初级/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/03/16/spark初级/" class="leancloud_visitors" data-flag-title="spark初级">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="u9884_u5907"><a href="#u9884_u5907" class="headerlink" title="预备"></a>预备</h1><p>从国内某约车软件实际工作出发，学习spark，特别感谢倚天同学指导。工作分了两部分，一部分是从hive表提取数据，第二部分是对本地数据进行统计。从hive提取数据需要hivesql相关知识，所以我先从第二份开始。</p>
<h1 id="spark__u672C_u5730_u6570_u636E_u7EDF_u8BA1"><a href="#spark__u672C_u5730_u6570_u636E_u7EDF_u8BA1" class="headerlink" title="spark 本地数据统计"></a>spark 本地数据统计</h1><pre><code>//指明包的位置，类似于java
package com.user

import java.util
import org.apache.spark.rdd.RDD
import org.apache.spark.spark{SparkConf,SparkContext}
/**
*
*created by yitian on 16/3/10
*/
object Stat{
    def main(args: Array[String]){
    //首先要声明 sparkconf 和sparkcontext
        val sparkConf=new SparkConf().setAppName(this.getClass.getName+&quot;#jitian&quot;)
        val sc=new SparkContext(sparkConf)

        val filePath=&quot;/user/data&quot;
        val outPath=&quot;user/output&quot;
        val period=28.0

        //统计阶段1
        val statData=sc.textFile(filePath).map{
            case str=&gt; 
                val content=str.split(&quot;\t&quot;)
                val pid=content(0)
                val phone=content(1)
                val pcost=content(3).toDouble
                val acost=content(4).toDouble
                ((pid,phone),(1,acost/pcost))

        }.reduceByKey((a,b)=&gt;(a._1+b._1,a._2+b._2))
        .map{case((pid,phone),(ocount,disSum))=&gt;
            ((pid,phone),(ocount/peroid,0.0,disSum,ocount))
        }

        //其他阶段统计
    }
}            
</code></pre><h1 id="u4F7F_u7528spark_u4ECEhive_u8868_u63D0_u53D6_u6570_u636E"><a href="#u4F7F_u7528spark_u4ECEhive_u8868_u63D0_u53D6_u6570_u636E" class="headerlink" title="使用spark从hive表提取数据"></a>使用spark从hive表提取数据</h1><pre><code>//部分
val sqlContext=new HiveContext(sc)
val sqlText=&quot; &quot;    //sql
val dataExtracted=sqlContext.sql(sqlText).map{
    case Row(pID: Long,pPhone: String,oId: Long,sCost:Double,aCost: Double)=&gt;pId.toString+&quot;\t&quot;+pPhone+&quot;\t&quot;
}.repartition(5).saveAsTextFile(FILE_LOCATION)
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/16/test-md/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="roger">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Just Roger">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Just Roger" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/16/test-md/" itemprop="url">
                  hive总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Дата создания записи" itemprop="dateCreated datePublished" datetime="2016-03-16T13:43:55+08:00">
                2016-03-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/03/16/test-md/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/16/test-md/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/03/16/test-md/" class="leancloud_visitors" data-flag-title="hive总结">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="u521B_u5EFA_28_u5916_29_u8868_u7684_u5178_u578B_u64CD_u4F5C"><a href="#u521B_u5EFA_28_u5916_29_u8868_u7684_u5178_u578B_u64CD_u4F5C" class="headerlink" title="创建(外)表的典型操作"></a>创建(外)表的典型操作</h1><pre><code>CREATE EXTERNAL TABEL &apos;passenger&apos;(
    &apos;city_id&apos; INT COMMENT &apos;城市id&apos;,
    ‘phone_number’ BIGINT COMMENT &apos;用户手机号&apos;
)
COMMENT &apos;用户表&apos;
PARTITION BY(
    &apos;year&apos; string,
    &apos;month&apos; string,
    &apos;day&apos; string
)
row format delimited
field terminated by &quot;\t&quot;
location &apos;hdfs: //---&apos;
/*增加partition*/
ALTER TABLE passenger ADD IF NOT EXISTS PARTITION(year=&apos;2016&apos;,month=&apos;03&apos;,day=&apos;11&apos;) location=&apos;2016/03/11&apos; 
</code></pre><h1 id="u67E5_u8BE2_u7ED3_u679C_u7684_u5B58_u50A8"><a href="#u67E5_u8BE2_u7ED3_u679C_u7684_u5B58_u50A8" class="headerlink" title="查询结果的存储"></a>查询结果的存储</h1><h2 id="u5B58_u50A8_u5230hive_u8868"><a href="#u5B58_u50A8_u5230hive_u8868" class="headerlink" title="存储到hive表"></a>存储到hive表</h2><pre><code>    //创建表
    insert overwrite table ***
    //查询语句
    select * ...## 存储到hdfs某一个目录
insert overwrite directory &apos;hdfs_dir/...&apos;
select *...
</code></pre><h2 id="u5B58_u50A8_u5230_u672C_u5730_u76EE_u5F55"><a href="#u5B58_u50A8_u5230_u672C_u5730_u76EE_u5F55" class="headerlink" title="存储到本地目录"></a>存储到本地目录</h2><pre><code>insert overwirte local directory &apos;local_dir/...&apos;
select * ...
</code></pre><h1 id="u5411hive_u8868_u88C5_u8F7D_u6570_u636E"><a href="#u5411hive_u8868_u88C5_u8F7D_u6570_u636E" class="headerlink" title="向hive表装载数据"></a>向hive表装载数据</h1><pre><code>//建表
LOAD DATA (LOCAL) INPATH &apos;/dir/...&apos;
OVERWRITE INTO TABLE tablename
PARTITION(dt=&apos; &apos;,country=&apos; &apos;);        //设置字段条件
</code></pre><h1 id="u5176_u4ED6_u547D_u4EE4"><a href="#u5176_u4ED6_u547D_u4EE4" class="headerlink" title="其他命令"></a>其他命令</h1><p>describe table; drop table ;show tables;!ls;</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/16/hive总结/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="roger">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Just Roger">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Just Roger" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/16/hive总结/" itemprop="url">
                  hive总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Дата создания записи" itemprop="dateCreated datePublished" datetime="2016-03-16T11:30:43+08:00">
                2016-03-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/03/16/hive总结/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/16/hive总结/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/03/16/hive总结/" class="leancloud_visitors" data-flag-title="hive总结">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="u521B_u5EFA_28_u5916_29_u8868_u7684_u5178_u578B_u64CD_u4F5C"><a href="#u521B_u5EFA_28_u5916_29_u8868_u7684_u5178_u578B_u64CD_u4F5C" class="headerlink" title="创建(外)表的典型操作"></a>创建(外)表的典型操作</h1><pre><code>CREATE EXTERNAL TABEL &apos;passenger&apos;(
    &apos;city_id&apos; INT COMMENT &apos;城市id&apos;,
    ‘phone_number’ BIGINT COMMENT &apos;用户手机号&apos;
)
COMMENT &apos;用户表&apos;
PARTITION BY(
    &apos;year&apos; string,
    &apos;month&apos; string,
    &apos;day&apos; string
)
row format delimited
field terminated by &quot;\t&quot;
location &apos;hdfs: //---&apos;
/*增加partition*/
ALTER TABLE passenger ADD IF NOT EXISTS PARTITION(year=&apos;2016&apos;,month=&apos;03&apos;,day=&apos;11&apos;) location=&apos;2016/03/11&apos; 
</code></pre><h1 id="u67E5_u8BE2_u7ED3_u679C_u7684_u5B58_u50A8"><a href="#u67E5_u8BE2_u7ED3_u679C_u7684_u5B58_u50A8" class="headerlink" title="查询结果的存储"></a>查询结果的存储</h1><h2 id="u5B58_u50A8_u5230hive_u8868"><a href="#u5B58_u50A8_u5230hive_u8868" class="headerlink" title="存储到hive表"></a>存储到hive表</h2><pre><code>//创建表
insert overwrite table ***
//查询语句
select * ...
</code></pre><h2 id="u5B58_u50A8_u5230hdfs_u67D0_u4E00_u4E2A_u76EE_u5F55"><a href="#u5B58_u50A8_u5230hdfs_u67D0_u4E00_u4E2A_u76EE_u5F55" class="headerlink" title="存储到hdfs某一个目录"></a>存储到hdfs某一个目录</h2><pre><code>insert overwrite directory &apos;hdfs_dir/...&apos;
select *...
</code></pre><h2 id="u5B58_u50A8_u5230_u672C_u5730_u76EE_u5F55"><a href="#u5B58_u50A8_u5230_u672C_u5730_u76EE_u5F55" class="headerlink" title="存储到本地目录"></a>存储到本地目录</h2><pre><code>insert overwirte local directory &apos;local_dir/...&apos;
select * ...
</code></pre><h1 id="u5411hive_u8868_u88C5_u8F7D_u6570_u636E"><a href="#u5411hive_u8868_u88C5_u8F7D_u6570_u636E" class="headerlink" title="向hive表装载数据"></a>向hive表装载数据</h1><pre><code>//建表
LOAD DATA (LOCAL) INPATH &apos;/dir/...&apos;
OVERWRITE INTO TABLE tablename
PARTITION(dt=&apos; &apos;,country=&apos; &apos;);        //设置字段条件
</code></pre><h1 id="u5176_u4ED6_u547D_u4EE4"><a href="#u5176_u4ED6_u547D_u4EE4" class="headerlink" title="其他命令"></a>其他命令</h1><p>describe table; drop table ;show tables;!ls;</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/01/05/2016读书总结/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="roger">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Just Roger">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Just Roger" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/05/2016读书总结/" itemprop="url">
                  2016读书总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Дата создания записи" itemprop="dateCreated datePublished" datetime="2016-01-05T21:57:39+08:00">
                2016-01-05
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/01/05/2016读书总结/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/05/2016读书总结/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/01/05/2016读书总结/" class="leancloud_visitors" data-flag-title="2016读书总结">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="2015_u5E74_u90E8_u5206_u8BFB_u4E66_u6E05_u5355"><a href="#2015_u5E74_u90E8_u5206_u8BFB_u4E66_u6E05_u5355" class="headerlink" title="2015年部分读书清单"></a>2015年部分读书清单</h1><p>岛上书店、时间守护着、浪潮之巅、黑客与画家、稀缺、富家美国</p>
<h1 id="2016_u5E74_u8BFB_u4E66_u603B_u7ED3"><a href="#2016_u5E74_u8BFB_u4E66_u603B_u7ED3" class="headerlink" title="2016年读书总结"></a>2016年读书总结</h1>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/01/05/2016版一日规划/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="roger">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Just Roger">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Just Roger" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/05/2016版一日规划/" itemprop="url">
                  2016版一日规划
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Дата создания записи" itemprop="dateCreated datePublished" datetime="2016-01-05T11:39:21+08:00">
                2016-01-05
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/01/05/2016版一日规划/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/05/2016版一日规划/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/01/05/2016版一日规划/" class="leancloud_visitors" data-flag-title="2016版一日规划">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="u4E00_u65E5_u4F5C_u606F"><a href="#u4E00_u65E5_u4F5C_u606F" class="headerlink" title="一日作息"></a>一日作息</h1><ol>
<li>6:50起床</li>
<li>喝水，厕所，温水洗漱，7：20出门</li>
<li>早餐：鸡蛋，粥</li>
<li>工作：<ol>
<li>查收工作邮件，结合前一晚工作安排，安排今日工作</li>
<li>上午安排最艰难工作</li>
<li>10：30 放松眼睛，加餐，水果，牛奶或燕麦，二十分钟</li>
<li>12:00 午餐：一荤一素，细嚼慢咽，八分饱</li>
</ol>
</li>
<li>12:30-1:00 微博qq社交</li>
<li>1：00-1：30 午睡</li>
<li>1:30-2:00 阅读杂志</li>
<li>工作：<ol>
<li>to do</li>
<li>4点半加餐，哑铃小运动</li>
<li>to do</li>
</ol>
</li>
<li>6:00 晚餐：一荤一素，细嚼慢咽，八分饱</li>
<li>6：30-7：00 阅读，查收邮件</li>
<li>7：00-10:00 工作，阅读，运动，录音</li>
<li>10:00-10:20 一天总结，第二天计划</li>
<li>10:20:撤,最后一次补水。洗漱，准备第二天衣服</li>
<li>11:00 睡！美梦</li>
</ol>
<h1 id="u8865_u5145"><a href="#u8865_u5145" class="headerlink" title="补充"></a>补充</h1><ol>
<li>工作期间qq不回，微信可以</li>
<li>上床不带手机</li>
<li>不吃油炸，不喝饮料，少吃高淀粉</li>
<li><p>碎片化的时间，不如路上可以背单词，听英文，听剧。</p>
<p>to be conti</p>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/12/30/Intersection/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="roger">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Just Roger">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Just Roger" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/30/Intersection/" itemprop="url">
                  Line Segment Intersection
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Дата создания записи" itemprop="dateCreated datePublished" datetime="2015-12-30T15:30:39+08:00">
                2015-12-30
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2015/12/30/Intersection/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/12/30/Intersection/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2015/12/30/Intersection/" class="leancloud_visitors" data-flag-title="Line Segment Intersection">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>Input: A set $S=\lbrace S_1,S_2,...,S_n\rbrace $ of(closed)line segment in $R^2$<br>Output: All <em>intersection points</em> between segements in S<br>In particular,we assume:  </p>
<ol>
<li>The x-coordinates of the endpoints and intersection points are all distinct.(This implies that no line segment is vertical).</li>
<li>If two segments intersect, then they intersect in a single point(they are not collinear).</li>
<li>No three lines intersect in a common point.</li>
</ol>
<h1 id="Plane_Sweep_Alg"><a href="#Plane_Sweep_Alg" class="headerlink" title="Plane Sweep Alg."></a>Plane Sweep Alg.</h1><h2 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h2><ol>
<li>Cleanliness property: all intersections to the left of sweep line $l$ have been reported</li>
<li>Sweep line status: store segments that intersect the sweep line $l$ ,ordered along the intersection with $l$.</li>
<li>Events: (1)Points in time when sweep line status chaneges combinatorially(i.e., the order of segments intersecting $l$ changes). (2)Endpoints of segments(insert in beginning) (3)Intersection points(computing on the fly during plane sweep)</li>
</ol>
<h2 id="Intersection_Lemma"><a href="#Intersection_Lemma" class="headerlink" title="Intersection Lemma"></a>Intersection Lemma</h2><p>＊Lemma＊: Let $s$,$s’$ be two non-vertical segments whose interiors intersect in a single point $p$. Assume there is no third segment passing through $p$. Then there is an event point to the left of $p$ where $s$ and $s$,$s’$ become adjacent(and hence are tested for intersection).</p>
<h2 id="Data_structure"><a href="#Data_structure" class="headerlink" title="Data structure"></a>Data structure</h2><ol>
<li>sweep line: orderded dictionary(balanced binary search tree) sorted vertically from top to down</li>
<li>future event points: priority queue ordered from left to right by x-coordinates</li>
</ol>
<h2 id="Alg"><a href="#Alg" class="headerlink" title="Alg"></a>Alg</h2><ol>
<li>Insert all of the points o the line segments of $S$ into the event queue. The initial sweep-line status is empty.</li>
<li>while the event queue is nonempty, extract the next event in the queue.There are there cases,depending on the type of the event:<ul>
<li><em>Left endpoints</em>:<br>  (a)insert this line segments $s$ into the sweep-line status,based on the y-coordinats of its left endpoints<br>  (b)Let $S$ and $s’$ be the segments immediately above and below $s$ on the sweep line. If there is an event associated with the pair, remove it from the event queue.<br>  (c)Test for intersection between $s$ and $s’$ and between $s$ and $s’’$ to the right of the sweep line. If so, add the correspoing event(s) to the event queue.</li>
<li><em>Right endpoint</em>:<br>  (a)Let $s$ and $s’$ be the segments immediately above and below the sweep line.<br>  (b)Delete segments $s$ from the sweep line status.<br>  (c)Test for intersections between $s$ and $s’$ to the right of the sweep line. If so, add the corresponding event to the event queue.</li>
<li><em>Intersecion</em>:<br>  (a) report this intersection.<br>  (b) Let $s$ and $s’$ be the two intersecting segments. Swap these two line segments in the sweep-line status.<br>  (c) As a result,$s$ and $s’$ have changed which segments are immediately above and below them. Remove any old events due to adjacencies that have ended and insert any new intersection events form adjacencies that have been created.</li>
</ul>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="roger" />
          <p class="site-author-name" itemprop="name">roger</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">12</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">roger</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"justroger"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("aKOHiuNClCa2AIMRorKmI1Nr-gzGzoHsz", "cVzdTFkduIPRmEzAlS9CosSg");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
